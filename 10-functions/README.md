# 10-functions

Contains an example of using functions with a language model.

## Libraries Involved

- `github.com/testcontainers/testcontainers-go`: [Testcontainers for Golang](https://github.com/testcontainers/testcontainers-go) is library for running Docker containers for integration tests.
- `github.com/testcontainers/testcontainers-go/modules/dockermodelrunner`: A module for running local language models using Testcontainers and the Docker Model Runner component of Docker Desktop.
- `github.com/tmc/langchaingo`: A library for interacting with language models.
- `github.com/tmc/langchaingo/llms/openai`: A specific implementation of the language model interface for OpenAI.

## Code Explanation

The code in `main.go` sets up and runs a local language model using Docker Model Runner through Testcontainers, then uses the model to generate text based on a given prompt, functions and a system prompt that enables the use of the functions.

This example has been inspired by https://github.com/tmc/langchaingo/blob/main/examples/openai-function-call-example.

### Main Functions

- `main()`: The entry point of the application. It calls the `run()` function and logs any errors.
- `run()`: The main logic of the application. It performs the following steps:
  1. Runs a local model using the [Docker Model Runner container](https://golang.testcontainers.org/modules/dockermodelrunner/). The model used is `ai/llama3.2:3B-Q4_K_M`, which is available in [Docker's GenAI catalog](https://hub.docker.com/catalogs/gen-ai).
  2. Creates a new OpenAI language model instance, using the container's OpenAI-compatible endpoint.
  3. Defines the content to be generated by the language model, using a strict system prompt to use the tools.
  4. Defines a `fetchPokeAPI` tool that finds information about a pokemon using PokeAPI (https://pokeapi.co/). This tool is used by the LLM to find information about a pokemon.
  5. Defines a loop to call the language model with the tools until it has all the information it needs. This is needed because smaller models (especially smaller ones like 3B) often interpret the tool responses as the final answer and don't realize they need to generate additional content to synthesize/compare the results.
  6. Generates again the content, after receiving the tool responses, and prints it to the console.

## Running the Example

To run the example, navigate to the `10-functions` directory and run the following command:

```sh
go run -v ./...
```

The application will start a local language model and generate text based on the provided prompt and tools. The generated text will be displayed in the console, something like this:

```shell
2025/06/26 17:27:08 Question: I have two pokemons, Gengar and Haunter. Please fetch information for both Gengar and Haunter individually so you can compare their move counts.
Executing 1 tool calls
Executing 1 tool calls
Executing 0 tool calls
Here's a comparison of Gengar and Haunter:

**Move Count:** Gengar has 124 moves, while Haunter has 99 moves. Gengar has 25 more moves than Haunter.

**Move Types:** Both Gengar and Haunter have a similar set of move types, including Ghost, Poison, and Psychic-type moves. However, Gengar has a slightly broader range of move types, with more options for dealing with physical and special attacking types.

**Overall:** Gengar is a more versatile and powerful Pok√©mon than Haunter, with a larger move pool and a wider range of types. However, Haunter is still a formidable opponent with a strong set of moves, particularly in the Ghost/Poison type category.
```
